{"version":3,"sources":["meteor://ðŸ’»app/client/scripts/lib/app.js","meteor://ðŸ’»app/client/scripts/controllers/chat.controller.js","meteor://ðŸ’»app/client/scripts/controllers/chats.controller.js","meteor://ðŸ’»app/client/scripts/controllers/confirmation.controller.js","meteor://ðŸ’»app/client/scripts/controllers/login.controller.js","meteor://ðŸ’»app/client/scripts/controllers/new-chat.controller.js","meteor://ðŸ’»app/client/scripts/controllers/profile.controller.js","meteor://ðŸ’»app/client/scripts/controllers/settings.controller.js","meteor://ðŸ’»app/client/scripts/directives/input.directive.js","meteor://ðŸ’»app/client/scripts/filters/calendar.filter.js","meteor://ðŸ’»app/client/scripts/filters/chat-name.filter.js","meteor://ðŸ’»app/client/scripts/filters/chat-picture.filter.js","meteor://ðŸ’»app/client/scripts/services/new-chat.service.js","meteor://ðŸ’»app/client/scripts/routes.js","meteor://ðŸ’»app/lib/collections.js","meteor://ðŸ’»app/lib/methods.js"],"names":["Angular","Loader","Meteor","ChatsCtrl","ChatCtrl","ConfirmationCtrl","LoginCtrl","NewChatCtrl","ProfileCtrl","SettingsCtrl","InputDirective","CalendarFilter","ChatNameFilter","ChatPictureFilter","NewChatService","Routes","App","module","load","isCordova","element","document","on","onReady","ready","bootstrap","Ionic","_","MeteorCameraUI","Controller","Chats","Messages","arguments","chatId","$stateParams","isIOS","Platform","isWebView","helpers","messages","find","data","findOne","autoScroll","sendPicture","getPicture","err","handleError","callMethod","picture","type","sendMessage","isEmpty","message","text","inputUp","keyboardHeight","scrollBottom","inputDown","$ionicScrollDelegate","$getByHandle","resize","closeKeyboard","cordova","plugins","Keyboard","close","recentMessagesNum","length","autorun","currMessagesNum","getCollectionReactively","animate","$timeout","error","$log","$ionicPopup","alert","title","reason","template","okType","$name","$inject","showNewChatModal","NewChat","showModal","remove","chat","_id","Accounts","phone","$state","params","confirm","code","verifyPhone","go","login","confirmPopup","cssClass","okText","cancelText","cancelType","then","res","$ionicLoading","show","requestPhoneVerification","hide","subscribe","users","$ne","currentUserId","newChat","userId","userIds","$all","hideNewChatModal","goToChat","hideModal","profile","currentUser","name","updatePicture","width","height","updateName","logout","Directive","restrict","scope","link","bind","e","onFocus","onBlur","which","returnClose","blur","onReturn","Moment","Filter","filter","time","calendar","lastDay","sameDay","lastWeek","sameElse","otherId","without","otherUser","hasName","hasPicture","Service","templateUrl","$rootScope","$new","$ionicModal","fromTemplateUrl","modal","$destroy","Config","Runner","RoutesConfig","isAuthorized","configure","$stateProvider","state","url","abstract","resolve","user","chats","views","controller","$urlRouterProvider","otherwise","$auth","awaitUser","RoutesRunner","run","$on","args","last","Mongo","Collection","check","methods","newMessage","Error","Match","OneOf","String","timestamp","Date","messageId","insert","update","$set","lastMessage","createdAt","removeChat","include"],"mappings":"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","file":"/app.js","sourcesContent":["// Libs\nimport 'angular-animate';\nimport 'angular-meteor';\nimport 'angular-meteor-auth';\nimport 'angular-moment';\nimport 'angular-sanitize';\nimport 'angular-ui-router';\nimport 'ionic-scripts';\nimport Angular from 'angular';\nimport Loader from 'angular-ecmascript/module-loader';\nimport { Meteor } from 'meteor/meteor';\n\n// Modules\nimport ChatsCtrl from '../controllers/chats.controller';\nimport ChatCtrl from '../controllers/chat.controller';\nimport ConfirmationCtrl from '../controllers/confirmation.controller';\nimport LoginCtrl from '../controllers/login.controller';\nimport NewChatCtrl from '../controllers/new-chat.controller';\nimport ProfileCtrl from '../controllers/profile.controller';\nimport SettingsCtrl from '../controllers/settings.controller';\nimport InputDirective from '../directives/input.directive';\nimport CalendarFilter from '../filters/calendar.filter';\nimport ChatNameFilter from '../filters/chat-name.filter';\nimport ChatPictureFilter from '../filters/chat-picture.filter';\nimport NewChatService from '../services/new-chat.service';\nimport Routes from '../routes';\n\nconst App = 'Whatsapp';\n\n// App\nAngular.module(App, [\n  'angular-meteor',\n  'angular-meteor.auth',\n  'angularMoment',\n  'ionic'\n]);\n\nnew Loader(App)\n  .load(ChatsCtrl)\n  .load(ChatCtrl)\n  .load(ConfirmationCtrl)\n  .load(LoginCtrl)\n  .load(NewChatCtrl)\n  .load(ProfileCtrl)\n  .load(SettingsCtrl)\n  .load(InputDirective)\n  .load(CalendarFilter)\n  .load(ChatNameFilter)\n  .load(ChatPictureFilter)\n  .load(NewChatService)\n  .load(Routes);\n\n// Startup\nif (Meteor.isCordova) {\n  Angular.element(document).on('deviceready', onReady);\n}\nelse {\n  Angular.element(document).ready(onReady);\n}\n\nfunction onReady() {\n  Angular.bootstrap(document, [App]);\n}\n","import Ionic from 'ionic-scripts';\nimport { _ } from 'meteor/underscore';\nimport { Meteor } from 'meteor/meteor';\nimport { MeteorCameraUI } from 'meteor/okland:camera-ui';\nimport { Controller } from 'angular-ecmascript/module-helpers';\nimport { Chats, Messages } from '../../../lib/collections';\n\nexport default class ChatCtrl extends Controller {\n  constructor() {\n    super(...arguments);\n\n    this.chatId = this.$stateParams.chatId;\n    this.isIOS = Ionic.Platform.isWebView() && Ionic.Platform.isIOS();\n    this.isCordova = Meteor.isCordova;\n\n    this.helpers({\n      messages() {\n        return Messages.find({ chatId: this.chatId });\n      },\n      data() {\n        return Chats.findOne(this.chatId);\n      }\n    });\n\n    this.autoScroll();\n  }\n\n  sendPicture() {\n    MeteorCameraUI.getPicture({}, (err, data) => {\n      if (err) return this.handleError(err);\n\n      this.callMethod('newMessage', {\n        picture: data,\n        type: 'picture',\n        chatId: this.chatId\n      });\n    });\n  }\n\n  sendMessage() {\n    if (_.isEmpty(this.message)) return;\n\n    this.callMethod('newMessage', {\n      text: this.message,\n      type: 'text',\n      chatId: this.chatId\n    });\n\n    delete this.message;\n  }\n\n  inputUp () {\n    if (this.isIOS) {\n      this.keyboardHeight = 216;\n    }\n\n    this.scrollBottom(true);\n  }\n\n  inputDown () {\n    if (this.isIOS) {\n      this.keyboardHeight = 0;\n    }\n\n    this.$ionicScrollDelegate.$getByHandle('chatScroll').resize();\n  }\n\n  closeKeyboard () {\n    if (this.isCordova) {\n      cordova.plugins.Keyboard.close();\n    }\n  }\n\n  autoScroll() {\n    let recentMessagesNum = this.messages.length;\n\n    this.autorun(() => {\n      const currMessagesNum = this.getCollectionReactively('messages').length;\n      const animate = recentMessagesNum != currMessagesNum;\n      recentMessagesNum = currMessagesNum;\n      this.scrollBottom(animate);\n    });\n  }\n\n  scrollBottom(animate) {\n    this.$timeout(() => {\n      this.$ionicScrollDelegate.$getByHandle('chatScroll').scrollBottom(animate);\n    }, 300);\n  }\n\n  handleError(err) {\n    if (err.error == 'cancel') return;\n    this.$log.error('Profile save error ', err);\n\n    this.$ionicPopup.alert({\n      title: err.reason || 'Save failed',\n      template: 'Please try again',\n      okType: 'button-positive button-clear'\n    });\n  }\n}\n\nChatCtrl.$name = 'ChatCtrl';\nChatCtrl.$inject = ['$stateParams', '$timeout', '$ionicScrollDelegate', '$ionicPopup', '$log'];\n","import { Controller } from 'angular-ecmascript/module-helpers';\nimport { Chats } from '../../../lib/collections';\n\nexport default class ChatsCtrl extends Controller {\n  constructor() {\n    super(...arguments);\n\n    this.helpers({\n      data() {\n        return Chats.find();\n      }\n    });\n  }\n\n  showNewChatModal() {\n    this.NewChat.showModal();\n  }\n\n  remove(chat) {\n    this.callMethod('removeChat', chat._id);\n  }\n}\n\nChatsCtrl.$name = 'ChatsCtrl';\nChatsCtrl.$inject = ['NewChat'];\n","import { _ } from 'meteor/underscore';\nimport { Accounts } from 'meteor/accounts-base';\nimport { Controller } from 'angular-ecmascript/module-helpers';\n\nexport default class ConfirmationCtrl extends Controller {\n  constructor() {\n    super(...arguments);\n\n    this.phone = this.$state.params.phone;\n  }\n\n  confirm() {\n    if (_.isEmpty(this.code)) return;\n\n    Accounts.verifyPhone(this.phone, this.code, (err) => {\n      if (err) return this.handleError(err);\n      this.$state.go('profile');\n    });\n  }\n\n  handleError(err) {\n    this.$log.error('Confirmation error ', err);\n\n    this.$ionicPopup.alert({\n      title: err.reason || 'Confirmation failed',\n      template: 'Please try again',\n      okType: 'button-positive button-clear'\n    });\n  }\n}\n\nConfirmationCtrl.$name = 'ConfirmationCtrl';\nConfirmationCtrl.$inject = ['$state', '$ionicPopup', '$log'];","import { _ } from 'meteor/underscore';\nimport { Accounts } from 'meteor/accounts-base';\nimport { Controller } from 'angular-ecmascript/module-helpers';\n\nexport default class LoginCtrl extends Controller {\n  login() {\n    if (_.isEmpty(this.phone)) return;\n\n    const confirmPopup = this.$ionicPopup.confirm({\n      title: 'Number confirmation',\n      template: '<div>' + this.phone + '</div><div>Is your phone number above correct?</div>',\n      cssClass: 'text-center',\n      okText: 'Yes',\n      okType: 'button-positive button-clear',\n      cancelText: 'edit',\n      cancelType: 'button-dark button-clear'\n    });\n\n    confirmPopup.then((res) => {\n      if (!res) return;\n\n      this.$ionicLoading.show({\n        template: 'Sending verification code...'\n      });\n\n      Accounts.requestPhoneVerification(this.phone, (err) => {\n        this.$ionicLoading.hide();\n        if (err) return this.handleError(err);\n        this.$state.go('confirmation', { phone: this.phone });\n      });\n    });\n  }\n\n  handleError(err) {\n    this.$log.error('Login error ', err);\n\n    this.$ionicPopup.alert({\n      title: err.reason || 'Login failed',\n      template: 'Please try again',\n      okType: 'button-positive button-clear'\n    });\n  }\n}\n\nLoginCtrl.$name = 'LoginCtrl';\nLoginCtrl.$inject = ['$state', '$ionicLoading', '$ionicPopup', '$log'];","import { Meteor } from 'meteor/meteor';\nimport { Controller } from 'angular-ecmascript/module-helpers';\nimport { Chats } from '../../../lib/collections';\n\nexport default class NewChatCtrl extends Controller {\n  constructor() {\n    super(...arguments);\n\n    this.subscribe('users');\n\n    this.helpers({\n      users() {\n        return Meteor.users.find({ _id: { $ne: this.currentUserId } });\n      }\n    });\n  }\n\n  newChat(userId) {\n    let chat = Chats.findOne({ userIds: { $all: [this.currentUserId, userId] } });\n\n    if (chat) {\n      this.hideNewChatModal();\n      return this.goToChat(chat._id);\n    }\n\n    this.callMethod('newChat', userId, (err, chatId) => {\n      this.hideNewChatModal();\n      if (err) return this.handleError(err);\n      this.goToChat(chatId);\n    });\n  }\n\n  hideNewChatModal() {\n    this.NewChat.hideModal();\n  }\n\n  goToChat(chatId) {\n    this.$state.go('tab.chat', { chatId });\n  }\n\n  handleError(err) {\n    this.$log.error('New chat creation error ', err);\n\n    this.$ionicPopup.alert({\n      title: err.reason || 'New chat creation failed',\n      template: 'Please try again',\n      okType: 'button-positive button-clear'\n    });\n  }\n}\n\nNewChatCtrl.$name = 'NewChatCtrl';\nNewChatCtrl.$inject = ['$state', 'NewChat', '$ionicPopup', '$log'];","import { _ } from 'meteor/underscore';\nimport { MeteorCameraUI } from 'meteor/okland:camera-ui';\nimport { Controller } from 'angular-ecmascript/module-helpers';\n\nexport default class ProfileCtrl extends Controller {\n  constructor() {\n    super(...arguments);\n\n    const profile = this.currentUser && this.currentUser.profile;\n    this.name = profile ? profile.name : '';\n  }\n\n  updatePicture () {\n    MeteorCameraUI.getPicture({ width: 60, height: 60 }, (err, data) => {\n      if (err) return this.handleError(err);\n\n      this.$ionicLoading.show({\n        template: 'Updating picture...'\n      });\n\n      this.callMethod('updatePicture', data, (err) => {\n        this.$ionicLoading.hide();\n        this.handleError(err);\n      });\n    });\n  }\n\n  updateName() {\n    if (_.isEmpty(this.name)) return;\n\n    this.callMethod('updateName', this.name, (err) => {\n      if (err) return this.handleError(err);\n      this.$state.go('tab.chats');\n    });\n  }\n\n  handleError(err) {\n    if (err.error == 'cancel') return;\n    this.$log.error('Profile save error ', err);\n\n    this.$ionicPopup.alert({\n      title: err.reason || 'Save failed',\n      template: 'Please try again',\n      okType: 'button-positive button-clear'\n    });\n  }\n}\n\nProfileCtrl.$name = 'ProfileCtrl';\nProfileCtrl.$inject = ['$state', '$ionicLoading', '$ionicPopup', '$log'];\n","import { Meteor } from 'meteor/meteor';\nimport { Controller } from 'angular-ecmascript/module-helpers';\n\nexport default class SettingsCtrl extends Controller {\n  logout() {\n    Meteor.logout((err) => {\n      if (err) return this.handleError(err);\n      this.$state.go('login');\n    })\n  }\n\n  handleError (err) {\n    this.$log.error('Settings modification error', err);\n\n    this.$ionicPopup.alert({\n      title: err.reason || 'Settings modification failed',\n      template: 'Please try again',\n      okType: 'button-positive button-clear'\n    });\n  }\n}\n\nSettingsCtrl.$inject = ['$state', '$ionicPopup', '$log'];","import { Directive } from 'angular-ecmascript/module-helpers';\n\nexport default class InputDirective extends Directive {\n  constructor() {\n    super(...arguments);\n\n    this.restrict = 'E';\n\n    this.scope = {\n      'returnClose': '=',\n      'onReturn': '&',\n      'onFocus': '&',\n      'onBlur': '&'\n    };\n  }\n\n  link(scope, element) {\n    element.bind('focus', (e) => {\n      if (!scope.onFocus) return;\n\n      this.$timeout(() => {\n        scope.onFocus();\n      });\n    });\n\n    element.bind('blur', (e) => {\n      if (!scope.onBlur) return;\n\n      this.$timeout(() => {\n        scope.onBlur();\n      });\n    });\n\n    element.bind('keydown', (e) => {\n      if (e.which != 13) return;\n\n      if (scope.returnClose) {\n        element[0].blur();\n      }\n\n      if (scope.onReturn) {\n        this.$timeout(() => {\n          scope.onReturn();\n        });\n      }\n    });\n  }\n}\n\nInputDirective.$name = 'input';\nInputDirective.$inject = ['$timeout'];","import Moment from 'moment';\nimport { Filter } from 'angular-ecmascript/module-helpers';\n\nexport default class CalendarFilter extends Filter {\n  filter(time) {\n    if (!time) return;\n\n    return Moment(time).calendar(null, {\n      lastDay : '[Yesterday]',\n      sameDay : 'LT',\n      lastWeek : 'dddd',\n      sameElse : 'DD/MM/YY'\n    });\n  }\n}\n\nCalendarFilter.$name = 'calendar';","import { _ } from 'meteor/underscore';\nimport { Meteor } from 'meteor/meteor';\nimport { Filter } from 'angular-ecmascript/module-helpers';\n\nexport default class ChatNameFilter extends Filter {\n  filter(chat) {\n    if (!chat) return;\n\n    let otherId = _.without(chat.userIds, Meteor.userId())[0];\n    let otherUser = Meteor.users.findOne(otherId);\n    let hasName = otherUser && otherUser.profile && otherUser.profile.name;\n\n    return hasName ? otherUser.profile.name : chat.name || 'NO NAME';\n  }\n}\n\nChatNameFilter.$name = 'chatName';\n","import { _ } from 'meteor/underscore';\nimport { Meteor } from 'meteor/meteor';\nimport { Filter } from 'angular-ecmascript/module-helpers';\n\nexport default class ChatPictureFilter extends Filter {\n  filter(chat) {\n    if (!chat) return;\n\n    let otherId = _.without(chat.userIds, Meteor.userId())[0];\n    let otherUser = Meteor.users.findOne(otherId);\n    let hasPicture = otherUser && otherUser.profile && otherUser.profile.picture;\n\n    return hasPicture ? otherUser.profile.picture : chat.picture || '/user-default.svg';\n  };\n}\n\nChatPictureFilter.$name = 'chatPicture';","import { Service } from 'angular-ecmascript/module-helpers';\n\nexport default class NewChatService extends Service {\n  constructor() {\n    super(...arguments);\n\n    this.templateUrl = 'client/templates/new-chat.html';\n  }\n\n  showModal() {\n    this.scope = this.$rootScope.$new();\n\n    this.$ionicModal.fromTemplateUrl(this.templateUrl, {\n      scope: this.scope\n    })\n    .then((modal) => {\n      this.modal = modal;\n      this.modal.show();\n    });\n  }\n\n  hideModal() {\n    this.scope.$destroy();\n    this.modal.remove();\n  }\n}\n\nNewChatService.$name = 'NewChat';\nNewChatService.$inject = ['$rootScope', '$ionicModal'];","import { _ } from 'meteor/underscore';\nimport { Meteor } from 'meteor/meteor';\nimport { Config, Runner } from 'angular-ecmascript/module-helpers';\n\nclass RoutesConfig extends Config {\n  constructor() {\n    super(...arguments);\n\n    this.isAuthorized = ['$auth', this.isAuthorized.bind(this)];\n  }\n\n  configure() {\n    this.$stateProvider\n      .state('tab', {\n        url: '/tab',\n        abstract: true,\n        templateUrl: 'client/templates/tabs.html',\n        resolve: {\n          user: this.isAuthorized,\n          chats() {\n            return Meteor.subscribe('chats');\n          }\n        }\n      })\n      .state('tab.chats', {\n        url: '/chats',\n        views: {\n          'tab-chats': {\n            templateUrl: 'client/templates/chats.html',\n            controller: 'ChatsCtrl as chats'\n          }\n        }\n      })\n      .state('tab.chat', {\n        url: '/chats/:chatId',\n        views: {\n          'tab-chats': {\n            templateUrl: 'client/templates/chat.html',\n            controller: 'ChatCtrl as chat'\n          }\n        }\n      })\n      .state('login', {\n        url: '/login',\n        templateUrl: 'client/templates/login.html',\n        controller: 'LoginCtrl as logger'\n      })\n      .state('confirmation', {\n        url: '/confirmation/:phone',\n        templateUrl: 'client/templates/confirmation.html',\n        controller: 'ConfirmationCtrl as confirmation'\n      })\n      .state('profile', {\n        url: '/profile',\n        templateUrl: 'client/templates/profile.html',\n        controller: 'ProfileCtrl as profile',\n        resolve: {\n          user: this.isAuthorized\n        }\n      })\n      .state('tab.settings', {\n        url: '/settings',\n        views: {\n          'tab-settings': {\n            templateUrl: 'client/templates/settings.html',\n            controller: 'SettingsCtrl as settings',\n          }\n        }\n      });\n\n    this.$urlRouterProvider.otherwise('tab/chats');\n  }\n\n  isAuthorized($auth) {\n    return $auth.awaitUser();\n  }\n}\n\nRoutesConfig.$inject = ['$stateProvider', '$urlRouterProvider'];\n\nclass RoutesRunner extends Runner {\n  run() {\n    this.$rootScope.$on('$stateChangeError', (...args) => {\n      const err = _.last(args);\n\n      if (err === 'AUTH_REQUIRED') {\n        this.$state.go('login');\n      }\n    });\n  }\n}\n\nRoutesRunner.$inject = ['$rootScope', '$state'];\n\nexport default [RoutesConfig, RoutesRunner];","import { Mongo } from 'meteor/mongo';\n\nexport const Chats = new Mongo.Collection('chats');\nexport const Messages = new Mongo.Collection('messages');","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport { Chats, Messages } from '../lib/collections';\n\nMeteor.methods({\n  newMessage(message) {\n    if (!this.userId) {\n      throw new Meteor.Error('not-logged-in',\n        'Must be logged in to send message.');\n    }\n\n    check(message, Match.OneOf(\n      {\n        text: String,\n        type: String,\n        chatId: String\n      },\n      {\n        picture: String,\n        type: String,\n        chatId: String\n      }\n    ));\n\n    message.timestamp = new Date();\n    message.userId = this.userId;\n\n    const messageId = Messages.insert(message);\n    Chats.update(message.chatId, { $set: { lastMessage: message } });\n\n    return messageId;\n  },\n  updateName(name) {\n    if (!this.userId) {\n      throw new Meteor.Error('not-logged-in',\n        'Must be logged in to update his name.');\n    }\n\n    check(name, String);\n\n    if (name.length === 0) {\n      throw Meteor.Error('name-required', 'Must provide a user name');\n    }\n\n    return Meteor.users.update(this.userId, { $set: { 'profile.name': name } });\n  },\n  newChat(otherId) {\n    if (!this.userId) {\n      throw new Meteor.Error('not-logged-in',\n        'Must be logged to create a chat.');\n    }\n\n    check(otherId, String);\n    const otherUser = Meteor.users.findOne(otherId);\n\n    if (!otherUser) {\n      throw new Meteor.Error('user-not-exists',\n        'Chat\\'s user not exists');\n    }\n\n    const chat = {\n      userIds: [this.userId, otherId],\n      createdAt: new Date()\n    };\n\n    const chatId = Chats.insert(chat);\n\n    return chatId;\n  },\n  removeChat(chatId) {\n    if (!this.userId) {\n      throw new Meteor.Error('not-logged-in',\n        'Must be logged to create a chat.');\n    }\n\n    check(chatId, String);\n\n    const chat = Chats.findOne(chatId);\n\n    if (!chat || !_.include(chat.userIds, this.userId)) {\n      throw new Meteor.Error('chat-not-exists',\n        'Chat not exists');\n    }\n\n    Messages.remove({ chatId: chatId });\n\n    return Chats.remove({ _id: chatId });\n  },\n  updatePicture(data) {\n    if (!this.userId) {\n      throw new Meteor.Error('not-logged-in',\n        'Must be logged in to update his picture.');\n    }\n\n    check(data, String);\n\n    return Meteor.users.update(this.userId, { $set: { 'profile.picture': data } });\n  }\n});"]}