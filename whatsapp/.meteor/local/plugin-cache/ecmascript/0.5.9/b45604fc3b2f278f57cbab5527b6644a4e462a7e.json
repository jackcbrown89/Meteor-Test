{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck"],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"angular-ecmascript/module-helpers","imported":["Controller"],"specifiers":[{"kind":"named","imported":"Controller","local":"Controller"}]},{"source":"../../../lib/collections","imported":["Chats"],"specifiers":[{"kind":"named","imported":"Chats","local":"Chats"}]}],"exports":{"exported":["NewChatCtrl"],"specifiers":[{"kind":"local","local":"NewChatCtrl","exported":"default"}]}}},"options":{"filename":"/client/scripts/controllers/new-chat.controller.js","filenameRelative":"/client/scripts/controllers/new-chat.controller.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/client/scripts/controllers/new-chat.controller.js.map","sourceFileName":"/client/scripts/controllers/new-chat.controller.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"new-chat.controller"},"ignored":false,"code":"var _classCallCheck;module.import('babel-runtime/helpers/classCallCheck',{\"default\":function(v){_classCallCheck=v}});var _possibleConstructorReturn;module.import('babel-runtime/helpers/possibleConstructorReturn',{\"default\":function(v){_possibleConstructorReturn=v}});var _inherits;module.import('babel-runtime/helpers/inherits',{\"default\":function(v){_inherits=v}});var Meteor;module.import('meteor/meteor',{\"Meteor\":function(v){Meteor=v}});var Controller;module.import('angular-ecmascript/module-helpers',{\"Controller\":function(v){Controller=v}});var Chats;module.import('../../../lib/collections',{\"Chats\":function(v){Chats=v}});\n\n\n\n\n\n\nvar NewChatCtrl = function (_Controller) {\n  _inherits(NewChatCtrl, _Controller);\n\n  function NewChatCtrl() {\n    _classCallCheck(this, NewChatCtrl);\n\n    var _this = _possibleConstructorReturn(this, _Controller.apply(this, arguments));\n\n    _this.subscribe('users');\n\n    _this.helpers({\n      users: function () {\n        function users() {\n          return Meteor.users.find({ _id: { $ne: this.currentUserId } });\n        }\n\n        return users;\n      }()\n    });\n    return _this;\n  }\n\n  NewChatCtrl.prototype.newChat = function () {\n    function newChat(userId) {\n      var _this2 = this;\n\n      var chat = Chats.findOne({ userIds: { $all: [this.currentUserId, userId] } });\n\n      if (chat) {\n        this.hideNewChatModal();\n        return this.goToChat(chat._id);\n      }\n\n      this.callMethod('newChat', userId, function (err, chatId) {\n        _this2.hideNewChatModal();\n        if (err) return _this2.handleError(err);\n        _this2.goToChat(chatId);\n      });\n    }\n\n    return newChat;\n  }();\n\n  NewChatCtrl.prototype.hideNewChatModal = function () {\n    function hideNewChatModal() {\n      this.NewChat.hideModal();\n    }\n\n    return hideNewChatModal;\n  }();\n\n  NewChatCtrl.prototype.goToChat = function () {\n    function goToChat(chatId) {\n      this.$state.go('tab.chat', { chatId: chatId });\n    }\n\n    return goToChat;\n  }();\n\n  NewChatCtrl.prototype.handleError = function () {\n    function handleError(err) {\n      this.$log.error('New chat creation error ', err);\n\n      this.$ionicPopup.alert({\n        title: err.reason || 'New chat creation failed',\n        template: 'Please try again',\n        okType: 'button-positive button-clear'\n      });\n    }\n\n    return handleError;\n  }();\n\n  return NewChatCtrl;\n}(Controller);\n\nmodule.export(\"default\",exports.default=(NewChatCtrl));\n\n\nNewChatCtrl.$name = 'NewChatCtrl';\nNewChatCtrl.$inject = ['$state', 'NewChat', '$ionicPopup', '$log'];","ast":null,"map":{"version":3,"sources":["/client/scripts/controllers/new-chat.controller.js"],"names":["Meteor","Controller","Chats","NewChatCtrl","arguments","subscribe","helpers","users","find","_id","$ne","currentUserId","newChat","userId","chat","findOne","userIds","$all","hideNewChatModal","goToChat","callMethod","err","chatId","handleError","NewChat","hideModal","$state","go","$log","error","$ionicPopup","alert","title","reason","template","okType","$name","$inject"],"mappings":";;;AAAA,SAASA,MAAT,QAAuB,eAAvB;AACA,SAASC,UAAT,QAA2B,mCAA3B;AACA,SAASC,KAAT,QAAsB,0BAAtB;;IAEqBC,W;;;AACnB,yBAAc;AAAA;;AAAA,iDACZ,wBAASC,SAAT,CADY;;AAGZ,UAAKC,SAAL,CAAe,OAAf;;AAEA,UAAKC,OAAL,CAAa;AACXC,WADW;AAAA,yBACH;AACN,iBAAOP,OAAOO,KAAP,CAAaC,IAAb,CAAkB,EAAEC,KAAK,EAAEC,KAAK,KAAKC,aAAZ,EAAP,EAAlB,CAAP;AACD;;AAHU;AAAA;AAAA,KAAb;AALY;AAUb;;wBAEDC,O;qBAAQC,M,EAAQ;AAAA;;AACd,UAAIC,OAAOZ,MAAMa,OAAN,CAAc,EAAEC,SAAS,EAAEC,MAAM,CAAC,KAAKN,aAAN,EAAqBE,MAArB,CAAR,EAAX,EAAd,CAAX;;AAEA,UAAIC,IAAJ,EAAU;AACR,aAAKI,gBAAL;AACA,eAAO,KAAKC,QAAL,CAAcL,KAAKL,GAAnB,CAAP;AACD;;AAED,WAAKW,UAAL,CAAgB,SAAhB,EAA2BP,MAA3B,EAAmC,UAACQ,GAAD,EAAMC,MAAN,EAAiB;AAClD,eAAKJ,gBAAL;AACA,YAAIG,GAAJ,EAAS,OAAO,OAAKE,WAAL,CAAiBF,GAAjB,CAAP;AACT,eAAKF,QAAL,CAAcG,MAAd;AACD,OAJD;AAKD;;;;;wBAEDJ,gB;gCAAmB;AACjB,WAAKM,OAAL,CAAaC,SAAb;AACD;;;;;wBAEDN,Q;sBAASG,M,EAAQ;AACf,WAAKI,MAAL,CAAYC,EAAZ,CAAe,UAAf,EAA2B,EAAEL,cAAF,EAA3B;AACD;;;;;wBAEDC,W;yBAAYF,G,EAAK;AACf,WAAKO,IAAL,CAAUC,KAAV,CAAgB,0BAAhB,EAA4CR,GAA5C;;AAEA,WAAKS,WAAL,CAAiBC,KAAjB,CAAuB;AACrBC,eAAOX,IAAIY,MAAJ,IAAc,0BADA;AAErBC,kBAAU,kBAFW;AAGrBC,gBAAQ;AAHa,OAAvB;AAKD;;;;;;EA5CsClC,U;;eAApBE,W;;;AA+CrBA,YAAYiC,KAAZ,GAAoB,aAApB;AACAjC,YAAYkC,OAAZ,GAAsB,CAAC,QAAD,EAAW,SAAX,EAAsB,aAAtB,EAAqC,MAArC,CAAtB","file":"/client/scripts/controllers/new-chat.controller.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Controller } from 'angular-ecmascript/module-helpers';\nimport { Chats } from '../../../lib/collections';\n\nexport default class NewChatCtrl extends Controller {\n  constructor() {\n    super(...arguments);\n\n    this.subscribe('users');\n\n    this.helpers({\n      users() {\n        return Meteor.users.find({ _id: { $ne: this.currentUserId } });\n      }\n    });\n  }\n\n  newChat(userId) {\n    let chat = Chats.findOne({ userIds: { $all: [this.currentUserId, userId] } });\n\n    if (chat) {\n      this.hideNewChatModal();\n      return this.goToChat(chat._id);\n    }\n\n    this.callMethod('newChat', userId, (err, chatId) => {\n      this.hideNewChatModal();\n      if (err) return this.handleError(err);\n      this.goToChat(chatId);\n    });\n  }\n\n  hideNewChatModal() {\n    this.NewChat.hideModal();\n  }\n\n  goToChat(chatId) {\n    this.$state.go('tab.chat', { chatId });\n  }\n\n  handleError(err) {\n    this.$log.error('New chat creation error ', err);\n\n    this.$ionicPopup.alert({\n      title: err.reason || 'New chat creation failed',\n      template: 'Please try again',\n      okType: 'button-positive button-clear'\n    });\n  }\n}\n\nNewChatCtrl.$name = 'NewChatCtrl';\nNewChatCtrl.$inject = ['$state', 'NewChat', '$ionicPopup', '$log'];"]},"hash":"b45604fc3b2f278f57cbab5527b6644a4e462a7e"}
